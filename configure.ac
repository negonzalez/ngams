#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

#
# The file is a merge from the file "configure.scan" generated by autoscan
# and modifications done by hand.
# Macros to be modified are headed with comments TO_BE_EDITED
# Already modified macros are headed with comments MODIFIED
# And macros added by hand are headed by comments ADDED

AC_PREREQ(2.59)
# TO_BE_EDITED: Enter here arguments to AC_INIT
# Example: AC_INIT(qfits, 5.4.0, jyung@eso.org)
# AC_INIT(FULL-PACKAGE-NAME, VERSION, BUG-REPORT-ADDRESS)
# Example: 
AC_INIT(ngams, 3.1, jknudstr@eso.org)

# MODIFIED: AC_CONFIG_SRCDIR
# A unique file that identifies the project. Example: Makefile.am
AC_CONFIG_SRCDIR([Makefile.am])
AC_CONFIG_HEADER([config.h])

# ADDED: AC_CONFIG_AUX_DIR: where to locate generated autotools macros
AC_CONFIG_AUX_DIR([admin])

# ADDED: AC_CANONICAL_*: macros to identify platform, cpu release,etc..
AC_CANONICAL_BUILD

# ADDED: AM_INIT_AUTOMAKE
AM_INIT_AUTOMAKE

# Checks for programs.
AC_PROG_CC
AC_CHECK_PROG([JAR], [jar], [jar])
#AM_PROG_GCJ


# MODIFIED. AC_PROG_RANLIB in comments
# AC_PROG_RANLIB for static libraries without Libtool
# AC_PROG_RANLIB

# ADDED. Using LIBTOOL
# AC_PROG_LIBTOOL for static and shared libraries with Libtool
AC_PROG_LIBTOOL
AC_ENABLE_STATIC([yes])
AC_ENABLE_SHARED([yes])
AC_SUBST(LIBTOOL_DEPS)


# ADDED.  Libtool versioning. 
# First release for <PROJECT> 0.0.0
LT_CURRENT=0
LT_REVISION=0
LT_AGE=0
AC_SUBST([LT_CURRENT])
AC_SUBST([LT_REVISION])
AC_SUBST([LT_AGE]) 

# Defining AM_CXXFLAGS for all SUBDIRS
#AM_CXXFLAGS=-DNOCCS
#AC_SUBST([AM_CXXFLAGS])
# It would also have worked with:
#CPPFLAGS=-DNOCCS
# or, if you want to append: 
#CPPFLAGS="$CPPFLAGS -DNOCCS"

# 
# Checks for libraries.
# FIXME: Replace `main' with a function in `-lm':
AC_CHECK_LIB([m], [main])
# REMOVED: Do not check for other libs
# FIXME: Replace `main' with a function in `-lqfits':
#AC_CHECK_LIB([qfits], [main])


# CHECK_CANONICAL_BUILD
AC_MSG_RESULT([BUILD=$build])
case $build in
   *-*-linux*)
     BUILD_DEF="-DSYSV_V2"
     SYSTEM_LIBS=""
     AC_MSG_RESULT([BUILD_DEF=$BUILD_DEF])
     ;;
   *-*-solaris*)
     BUILD_DEF="-DSYSV_V2"
     SYSTEM_LIBS="-lsocket"
     AC_MSG_RESULT([BUILD_DEF=$BUILD_DEF])
     ;;
   *-*-hpux*)
     BUILD_DEF="-DSYSV_V2"
     SYSTEM_LIBS=""
     AC_MSG_RESULT([BUILD_DEF=$BUILD_DEF])
     ;;
esac
AC_SUBST(BUILD_DEF)
AC_SUBST(SYSTEM_LIBS)

# Enter here your project-defined macros located in m4macros/<macros>.m4
# Example: QFITS_CHECK_XMEMORY located in m4macros/xmemory.m4
# Example: CHEC_INTROOT located in m4macros/introot.m4
#CHECK_INTROOT
#CHECK_CFITSIO
#CHECK_OSLX
#CHECK_SYBASE

# CHECK_CANONICAL_BUILD
AC_MSG_RESULT([BUILD=$build])
case $build in
   *-*-linux*)
     SYSTEM_LIBS=""
     AC_MSG_RESULT([SYSTEM_LIBS=$SYSTEM_LIBS])
     ;;
   *-*-solaris*)
     SYSTEM_LIBS="-lsocket -lnsl"
     AC_MSG_RESULT([SYSTEM_LIBS=$SYSTEM_LIBS])
     ;;
   *-*-hpux*)
     SYSTEM_LIBS=""
     AC_MSG_RESULT([SYSTEM_LIBS=$SYSTEM_LIBS])
     ;;
esac
AC_SUBST(SYSTEM_LIBS)

# List of checks are obtained from your source files by executing
# autorescan. It generates a configure.scan file with the suggested checks:
# Checks for header files.
#AC_HEADER_STDC
#AC_CHECK_HEADERS([fcntl.h stdlib.h string.h sys/time.h unistd.h])
#
# Checks for typedefs, structures, and compiler characteristics.
#AC_C_CONST
#AC_TYPE_SIZE_T
#AC_HEADER_TIME
#AC_STRUCT_TM
#
# Checks for library functions.
#AC_FUNC_MALLOC
#AC_FUNC_MMAP
#AC_FUNC_REALLOC
#AC_FUNC_STAT
#AC_FUNC_VPRINTF
#AC_CHECK_FUNCS([atexit getpagesize gettimeofday memchr memmove memset mkdir munmap regcomp rmdir strchr strdup strrchr strstr uname])

# ADDED: Other checks.Example BIG_ENDIAN
# AC_C_BIGENDIAN

# ADDED: Other checks. Example if this is a CPU_X86 machine
# case $host_cpu in
# i*86)
#     CPU_X86="`echo $host_cpu | cut -c 2-`"
#     AC_DEFINE_UNQUOTED([CPU_X86], $CPU_X86, [x86 CPU type])
#     ;;
# esac

# MODIFIED: List of directories where to build Makefiles
AC_CONFIG_FILES([Makefile
                 ngamsCClient/Makefile
                 ngamsJClient/src/Makefile
                 ngamsTest/Makefile])

AC_OUTPUT
